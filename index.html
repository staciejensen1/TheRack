<!DOCTYPE html>
<!--
  THE RACK - Reptile Breeding Program Management
  Version: 3.14
  Last Updated: 2026-01-10
  
  Changelog:
  - 3.14: Dashboard alerts now use Soft Slate Blue palette
  - 3.13: Pairings stats now show last 3 months; added Ovulations and Pre-Lay Sheds cards
  - 3.12: Added Delete button to Pairings table
  - 3.11: Fixed Activity form to save PAIRED WITH to column M
  - 3.10: Changed Clutch sheet references from CLUTCH ID to UNIQUE ID (column A renamed)
  - 3.9: Breeder and Clutch forms now use SHOW ONLY field lists; Added STRUCTURE.md
  - 3.7: All ID generators check for duplicates; Import generates UNIQUE ID and QR CODE
  - 3.6: Clutch form now shows ONLY explicit field list
  - 3.5: Rewrote Import Collection to handle Collection CSV format with auto-generated UNIQUE IDs
  - 3.4: Added Import Collection link to sidebar
  - 3.3: Fixed Clutches table to show CLUTCH ID column
  - 3.0: Fixed Pairings table columns
  - 2.12.54: Added Open Graph meta tags for social sharing preview image
  - 2.12.53: Added Help Guide page with full documentation
  - 2.12.52: Changed all TOTAL PAID references to AMOUNT PAID
  - 2.12.51: Removed AMOUNT PAID from Add Breeder form (stays on Record Sale form)
  - 2.12.50: Added search and filter bar to Pairings tab
  - 2.12.49: Hide all filter bars on Dashboard view
  - 2.12.48: Added Amount Paid field to Sale modal
  - 2.12.40: Removed PDF bin tag code, HTML print only
  - 2.12.39: Bin tag print - 3.18x1.93in tag, 0.10in bleed, locked
  - 2.12.4: Fixed Norwester font import (was missing from head section)
  - 2.12.3: Fixed bin tag layout to match final approved design
            Row 1: Logo 25% | Sex+ID 45% | QR 30%
            Row 2: Name 70% | INFO 30%
            Row 3: Genetics 70% | Year+Breeder 30%
  - 2.12.2: Added bin tag modal, added QR modal to HTML
  - 2.12.0: MAJOR REFACTOR - Split monolithic file into modular JS files
            - config.js: Configuration, constants, state
            - api.js: API calls, login, data loading
            - app.js: Init, navigation, utilities
            - dashboard.js: Dashboard rendering, stats
            - tables.js: Table rendering, filters
            - modals.js: Add/Edit modal forms
            - hatch-sale.js: Hatch and sale modals
            - tools.js: Export, settings, changelog
            - archive.js: Archive functions
            - bintags.js: QR codes and bin tag printing
            - import.js: MorphMarket import
            - invoice.js: Invoice generation
            - qr-activity.js: QR scan activity logging
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Rack - Breeding Program Management</title>
  
  <!-- Open Graph / Social Sharing Meta Tags -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://therackapp.io/">
  <meta property="og:title" content="The Rack - Breeding Program Management">
  <meta property="og:description" content="Rack it. Track it. Run it. The complete breeding program management tool for reptile breeders.">
  <meta property="og:image" content="https://therackapp.io/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://therackapp.io/">
  <meta name="twitter:title" content="The Rack - Breeding Program Management">
  <meta name="twitter:description" content="Rack it. Track it. Run it. The complete breeding program management tool for reptile breeders.">
  <meta name="twitter:image" content="https://therackapp.io/og-image.png">
  
  <!-- General Meta Tags -->
  <meta name="description" content="Rack it. Track it. Run it. The complete breeding program management tool for reptile breeders.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/norwester" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen">
  
  <div id="app" class="max-w-7xl mx-auto p-4 md:p-6">
    <!-- Header -->
    <header class="bg-white rounded-2xl p-4 md:p-6 shadow-sm mb-4 md:mb-6 border border-gray-200">
      <div class="flex items-center justify-between gap-4">
        <!-- Hamburger + Logo -->
        <div class="flex items-center gap-3">
          <!-- Hamburger Menu Button (mobile only) -->
          <button id="menuBtn" onclick="toggleMobileMenu()" class="md:hidden p-2 -ml-2 text-gray-700 hover:bg-gray-100 rounded-lg">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
          
          <!-- Logo SVG -->
          <svg viewBox="0 0 320 60" class="h-10 md:h-14" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(30, 25)">
              <path d="M-16 -14 L-8 -14 L0 -6 L-8 2 L0 10 L-8 18 L-16 18" 
                    stroke="#000" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 -14 L8 -14 L0 -6 L8 2 L0 10 L8 18 L16 18" 
                    stroke="#000" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="-16" cy="-14" r="2" fill="#000"/>
              <circle cx="16" cy="-14" r="2" fill="#000"/>
            </g>
            <text x="62" y="32" fill="#000" font-family="Inter, system-ui, sans-serif" font-weight="800" font-size="26" letter-spacing="-1">THE RACK</text>
            <text x="62" y="48" fill="#888" font-family="Inter, system-ui, sans-serif" font-weight="500" font-size="8" letter-spacing="2">RACK IT. TRACK IT. RUN IT.</text>
          </svg>
          <span id="versionTag" class="text-xs text-gray-400 hidden md:inline">v2.12.0</span>
        </div>

        <!-- Desktop: Login/Connected -->
        <div class="hidden md:flex flex-wrap items-center gap-2 md:gap-3">
          <!-- Login Form (shown when not logged in) -->
          <div id="loginGroup" class="flex flex-wrap items-center gap-2">
            <input
              type="email"
              id="emailInput"
              placeholder="Email (from purchase)"
              class="px-3 py-2 border border-gray-300 rounded-xl bg-gray-50 text-sm w-48 focus:border-gray-500 focus:ring-1 focus:ring-gray-500"
            />
            <input
              type="text"
              id="accessCodeInput"
              placeholder="Access Code"
              class="px-3 py-2 border border-gray-300 rounded-xl bg-gray-50 mono text-sm w-48 focus:border-gray-500 focus:ring-1 focus:ring-gray-500"
            />
            <button id="loginBtn" class="px-4 py-2 bg-gray-900 text-white font-bold rounded-xl hover:bg-black text-sm">
              Log In
            </button>
          </div>

          <!-- Connected Status (shown when logged in) -->
          <div id="connectedGroup" class="flex items-center gap-2 hidden">
            <span id="userEmail" class="text-sm text-gray-600"></span>
            <button id="syncBtn" onclick="loadData()" class="px-3 py-2 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 text-sm" title="Sync data">
               Sync
            </button>
            <button id="signOutBtn" class="px-3 py-2 bg-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-300 text-sm">
              Sign out
            </button>
          </div>
        </div>

        <!-- Mobile: Sync button only when logged in -->
        <div id="mobileSyncBtn" class="md:hidden hidden">
          <button onclick="loadData()" class="p-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200" title="Sync">
            Sync
          </button>
        </div>
      </div>

      <!-- Mobile Login Form -->
      <div id="mobileLoginGroup" class="md:hidden mt-4 hidden">
        <div class="flex flex-col gap-2">
          <input
            type="email"
            id="mobileEmailInput"
            placeholder="Email (from purchase)"
            class="px-3 py-2 border border-gray-300 rounded-xl bg-gray-50 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500"
          />
          <input
            type="text"
            id="mobileAccessCodeInput"
            placeholder="Access Code"
            class="px-3 py-2 border border-gray-300 rounded-xl bg-gray-50 mono text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500"
          />
          <button id="mobileLoginBtn" class="px-4 py-2 bg-gray-900 text-white font-bold rounded-xl hover:bg-black text-sm">
            Log In
          </button>
        </div>
      </div>

      <div class="mt-3 flex items-center gap-4 text-sm">
        <span id="statusText" class="text-gray-500">Starting up...</span>
      </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="fixed inset-0 bg-black/50 z-40 hidden md:hidden" onclick="toggleMobileMenu()"></div>
    
    <!-- Mobile Slide-out Menu -->
    <aside id="mobileMenu" class="fixed top-0 left-0 h-full w-72 bg-white shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 md:hidden overflow-y-auto">
      <div class="p-4">
        <div class="flex items-center justify-between mb-6">
          <span class="font-bold text-gray-900">Menu</span>
          <button onclick="toggleMobileMenu()" class="p-2 text-gray-500 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <!-- Mobile User Info -->
        <div id="mobileUserInfo" class="mb-6 p-3 bg-gray-50 rounded-xl hidden">
          <div id="mobileUserEmail" class="text-sm text-gray-600 truncate"></div>
          <button onclick="handleSignOut(); toggleMobileMenu();" class="mt-2 text-sm text-red-600 hover:text-red-700">Sign out</button>
        </div>

        <!-- Navigation -->
        <div class="mb-6">
          <div class="text-xs uppercase tracking-wider text-gray-400 font-semibold mb-2">Navigation</div>
          <nav id="mobileNavTabs" class="flex flex-col gap-1"></nav>
        </div>

        <!-- Quick Add -->
        <div class="mb-6">
          <div class="text-xs uppercase tracking-wider text-gray-400 font-semibold mb-2">Quick Add</div>
          <div class="flex flex-col gap-1">
            <button onclick="openAddModal('collection'); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-left">+ Breeder</button>
            <button onclick="openAddModal('clutch'); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-left">+ Clutch</button>
            <button onclick="openAddModal('hatchling'); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-left">+ Hatchling</button>
            <button onclick="openAddModal('activity'); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-left">+ Activity</button>
          </div>
        </div>

        <!-- Tools -->
        <div class="pt-4 border-t border-gray-100">
          <div class="text-xs uppercase tracking-wider text-gray-400 font-semibold mb-2">Tools</div>
          <div class="flex flex-col gap-1">
            <button onclick="openImportModal(); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Import Collection</button>
            <button onclick="navigateTo('sales'); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Create Invoice</button>
            <button onclick="openBinTagGenerator(); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Print Bin Tags</button>
            <button onclick="exportCSV('collection'); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Export Collection</button>
            <button onclick="exportCSV('clutch'); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Export Clutches</button>
            <button onclick="showDataHealth(); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Data Health</button>
            <button onclick="openQRGenerator(); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Print QR Codes</button>
            <button onclick="navigateTo('archive'); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Archive</button>
            <button onclick="openSettingsModal(); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Settings</button>
            <a href="help.html" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg block">Help Guide</a>
          </div>
        </div>

        <!-- Support -->
        <div class="mt-6 pt-4 border-t border-gray-100">
          <button onclick="openChangelogModal(); toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg block w-full text-left">
            What's New
          </button>
          <a href="https://docs.google.com/forms/d/e/1FAIpQLSc1cdNzPiLLteHIIUMD83yUc4BLZ1JL8hmpuwsiYUGMcPHBaQ/viewform" target="_blank" onclick="toggleMobileMenu();" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg block">
            Submit Support Ticket
          </a>
        </div>
      </div>
    </aside>

    <div class="flex flex-col md:flex-row gap-6">
      <!-- Desktop Sidebar -->
      <aside class="hidden md:block w-56 shrink-0">
        <div class="bg-white rounded-2xl p-4 shadow-sm sticky top-6 border border-gray-200">
          <!-- Quick Add -->
          <div class="mb-6">
            <div class="text-xs uppercase tracking-wider text-gray-400 font-semibold mb-2">Quick Add</div>
            <div class="flex flex-col gap-1">
              <button onclick="openAddModal('collection')" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-left">+ Breeder</button>
              <button onclick="openAddModal('clutch')" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-left">+ Clutch</button>
              <button onclick="openAddModal('hatchling')" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-left">+ Hatchling</button>
              <button onclick="openAddModal('activity')" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-left">+ Activity</button>
            </div>
          </div>
          
          <!-- Navigation -->
          <div class="text-xs uppercase tracking-wider text-gray-400 font-semibold mb-2">Navigation</div>
          <nav id="navTabs" class="flex flex-col gap-1">
          </nav>

          <!-- Tools -->
          <div class="mt-6 pt-4 border-t border-gray-100">
            <div class="text-xs uppercase tracking-wider text-gray-400 font-semibold mb-2">Tools</div>
            <div class="flex flex-col gap-1">
              <button onclick="openImportModal()" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Import Collection</button>
              <button onclick="navigateTo('sales')" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Create Invoice</button>
              <button onclick="openBinTagGenerator()" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Print Bin Tags</button>
              <button onclick="exportCSV('collection')" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Export Collection</button>
              <button onclick="exportCSV('clutch')" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Export Clutches</button>
              <button onclick="openQRGenerator()" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Print QR Codes</button>
              <button onclick="showDataHealth()" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Data Health</button>
              <button onclick="navigateTo('archive')" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Archive</button>
              <button onclick="openSettingsModal()" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg text-left">Settings</button>
              <a href="help.html" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg block">Help Guide</a>
            </div>
          </div>

          <!-- Support -->
          <div class="mt-6 pt-4 border-t border-gray-100">
            <button onclick="openChangelogModal()" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg block w-full text-left">
              What's New
            </button>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSc1cdNzPiLLteHIIUMD83yUc4BLZ1JL8hmpuwsiYUGMcPHBaQ/viewform" target="_blank" class="px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg block">
              Submit Support Ticket
            </a>
          </div>
        </div>
      </aside>

      <!-- Main content -->
      <main class="flex-1 min-w-0">
        <!-- Mobile Quick Add Bar -->
        <div class="md:hidden bg-white rounded-2xl p-3 shadow-sm border border-gray-200 mb-4">
          <div class="flex items-center justify-between gap-2 overflow-x-auto">
            <button onclick="openAddModal('collection')" class="flex-shrink-0 px-3 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-xl hover:bg-gray-200">+ Breeder</button>
            <button onclick="openAddModal('clutch')" class="flex-shrink-0 px-3 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-xl hover:bg-gray-200">+ Clutch</button>
            <button onclick="openAddModal('hatchling')" class="flex-shrink-0 px-3 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-xl hover:bg-gray-200">+ Hatchling</button>
            <button onclick="openAddModal('activity')" class="flex-shrink-0 px-3 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-xl hover:bg-gray-200">+ Activity</button>
          </div>
        </div>

        <div class="bg-white rounded-2xl p-4 md:p-6 shadow-sm border border-gray-200">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <button id="backBtn" onclick="goBack()" class="px-3 py-2 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 text-sm hidden">
                &lt; Back
              </button>
              <h2 id="pageTitle" class="text-xl font-bold text-gray-900 capitalize">Dashboard</h2>
            </div>
            <button id="addBtn" onclick="openAddForCurrentTab()" class="px-4 py-2 bg-gray-900 text-white font-bold rounded-xl hover:bg-black hidden text-sm">
              + Add New
            </button>
          </div>
          
          <!-- Dashboard -->
          <div id="dashboardView"></div>

          <!-- Stats Cards (shown on table pages) -->
          <div id="tableStatsView" class="hidden mb-4"></div>

          <!-- Filter Bar (shown on table pages) -->
          <div id="filterBar" class="hidden mb-4 flex flex-wrap gap-2 items-center">
            <input type="text" id="searchInput" placeholder="Search name or ID..." oninput="applyFilter('search', this.value)" class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white w-48">
            <select id="filterSex" onchange="applyFilter('sex', this.value)" class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white">
              <option value="">All Sex</option>
              <option value="Female">Female</option>
              <option value="Male">Male</option>
              <option value="Unknown">Unknown</option>
            </select>
            <select id="filterStatus" onchange="applyFilter('status', this.value)" class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white">
              <option value="">All Status</option>
              <option value="Breeder">Breeder</option>
              <option value="Listed">Listed</option>
              <option value="Unlisted">Unlisted</option>
              <option value="Holdback">Holdback</option>
              <option value="On Hold">On Hold</option>
              <option value="Sold">Sold</option>
              <option value="On Loan">On Loan</option>
            </select>
            <select id="filterSpecies" onchange="applyFilter('species', this.value)" class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white">
              <option value="">All Species</option>
            </select>
            <span id="geneFilterDisplay" class="hidden px-3 py-1 bg-gray-100 border border-gray-300 rounded-full text-sm flex items-center gap-2">
              <span id="geneFilterText"></span>
              <button onclick="clearGeneFilter()" class="text-gray-500 hover:text-gray-700">&times;</button>
            </span>
            <button id="clearFiltersBtn" onclick="clearAllFilters()" class="hidden px-3 py-2 text-gray-500 hover:text-gray-700 text-sm">
              Clear Filters
            </button>
          </div>
          
          <!-- Sales Filter Bar -->
          <div id="salesFilterBar" class="hidden mb-4 flex flex-wrap gap-2 items-center">
            <input type="text" id="salesSearchInput" placeholder="Search name or ID..." oninput="applyFilter('search', this.value)" class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white w-48">
            <select id="filterSalesYear" onchange="applyFilter('salesYear', this.value)" class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white">
              <option value="">All Years</option>
            </select>
            <select id="filterSalesStatus" onchange="applyFilter('salesStatus', this.value)" class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white">
              <option value="">All Status</option>
              <option value="On Hold">On Hold</option>
              <option value="Sold">Sold</option>
            </select>
          </div>
          
          <!-- Clutches Filter Bar -->
          <div id="clutchesFilterBar" class="hidden mb-4 flex flex-wrap gap-2 items-center">
            <input type="text" id="clutchSearchInput" placeholder="Search clutch ID..." oninput="applyFilter('search', this.value)" class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white w-48">
          </div>
          
          <!-- Alert Filter Display -->
          <div id="alertFilterDisplay" class="hidden mb-4">
            <span class="px-3 py-2 bg-gray-800 text-white rounded-full text-sm flex items-center gap-2 inline-flex">
              <span id="alertFilterLabel">Filter Active</span>
              <button onclick="clearAlertFilter()" class="text-gray-300 hover:text-white font-bold">&times;</button>
            </span>
          </div>

          <!-- Data table -->
          <div id="tableView" class="overflow-x-auto hidden">
            <table class="min-w-full text-sm">
              <thead id="tableHead">
                <tr class="border-b border-gray-200"></tr>
              </thead>
              <tbody id="tableBody" class="divide-y divide-gray-100"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Modals will be rendered dynamically -->
  <div id="modalContainer"></div>

  <!-- Bin Tag Modal -->
  <div id="binTagModal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-5xl my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <h3 class="text-xl font-bold text-slate-900">Print Bin Tags</h3>
          <button onclick="closeBinTagModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <div class="p-4 md:p-6">
          <!-- Printer Recommendations -->
          <div class="mb-6 bg-gray-50 border border-gray-200 rounded-xl p-4">
            <div class="text-sm font-semibold text-gray-800 mb-2">Recommended Supplies</div>
            <div class="text-sm text-gray-600 space-y-1">
              <div><strong>PVC Cards (waterproof):</strong> <a href="https://amzn.to/49KHshc" target="_blank" class="text-blue-600 hover:underline">3.38" x 2.13" PVC Cards on Amazon</a></div>
              <div><strong>Card Printer:</strong> <a href="https://amzn.to/4sookwS" target="_blank" class="text-blue-600 hover:underline">Recommended Printer on Amazon</a></div>
              <div class="text-gray-500 text-xs mt-2">Alternative: Use thick cardstock paper with any inkjet printer. PVC cards are waterproof and more durable for rack environments.</div>
            </div>
          </div>
          
          <!-- Options -->
          <div class="mb-6 flex flex-wrap gap-4 items-center">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Select Animals</label>
              <select id="binTagAnimalSelect" onchange="updateBinTagAnimalList(); updateBinTagPreview();" class="px-3 py-2 border border-gray-300 rounded-xl text-sm">
                <option value="all">All Animals</option>
                <option value="breeders">Breeders Only</option>
                <option value="hatchlings">Hatchlings Only</option>
              </select>
            </div>
            <button onclick="printBinTags()" id="binTagDownloadBtn" class="px-4 py-2 bg-gray-900 text-white font-bold rounded-xl hover:bg-black text-sm">
              Print
            </button>
          </div>
          
          <!-- Animal Selection List -->
          <div class="mb-4">
            <div class="flex items-center justify-between mb-2">
              <label class="text-sm font-medium text-gray-700">Select specific animals (or leave unchecked for all)</label>
              <div class="flex gap-2">
                <button onclick="selectAllBinTagAnimals()" class="text-xs text-gray-500 hover:text-gray-700">Select All</button>
                <span class="text-gray-300">|</span>
                <button onclick="deselectAllBinTagAnimals()" class="text-xs text-gray-500 hover:text-gray-700">Deselect All</button>
              </div>
            </div>
            <div id="binTagAnimalList" class="border border-gray-200 rounded-xl p-3 bg-gray-50 max-h-40 overflow-auto">
              <p class="text-gray-500 text-sm">Loading animals...</p>
            </div>
            <div class="mt-2 text-sm text-gray-500">
              <span id="binTagSelectedCount">0</span> animals selected
            </div>
          </div>
          
          <!-- Preview -->
          <div class="text-sm font-medium text-gray-700 mb-2">Preview</div>
          <div id="binTagPreview" class="border border-gray-200 rounded-xl p-4 bg-gray-100 overflow-auto" style="max-height: 500px;">
            <p class="text-gray-500 text-sm">Select animals to see preview...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- QR Code Modal -->
  <div id="qrModal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-4xl my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <h3 class="text-xl font-bold text-slate-900">Print QR Codes</h3>
          <button onclick="closeQRModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <div class="p-4 md:p-6">
          <!-- Options -->
          <div class="mb-6 flex flex-wrap gap-4 items-center">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Select Animals</label>
              <select id="qrAnimalSelect" onchange="updateQRPreview()" class="px-3 py-2 border border-gray-300 rounded-xl text-sm">
                <option value="all">All Animals</option>
                <option value="breeders">Breeders Only</option>
                <option value="hatchlings">Hatchlings Only</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Label Size</label>
              <select id="qrSizeSelect" onchange="updateQRPreview()" class="px-3 py-2 border border-gray-300 rounded-xl text-sm">
                <option value="small">Small (1" x 1")</option>
                <option value="medium" selected>Medium (1.5" x 1.5")</option>
                <option value="large">Large (2" x 2")</option>
              </select>
            </div>
            <button onclick="printQRCodes()" class="px-4 py-2 bg-gray-900 text-white font-bold rounded-xl hover:bg-black text-sm">
              Print
            </button>
          </div>
          
          <!-- Preview -->
          <div id="qrPreview" class="border border-gray-200 rounded-xl p-4 bg-gray-50 max-h-96 overflow-auto">
            <p class="text-gray-500 text-sm">Loading preview...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bin Tag Generator Modal -->
  <div id="binTagModal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-5xl my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <h3 class="text-xl font-bold text-slate-900">Print Bin Tags</h3>
          <button onclick="closeBinTagModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <div class="p-4 md:p-6">
          <!-- Printer Recommendations -->
          <div class="mb-6 bg-gray-50 border border-gray-200 rounded-xl p-4">
            <div class="text-sm font-semibold text-gray-800 mb-2">Recommended Supplies</div>
            <div class="text-sm text-gray-600 space-y-1">
              <div><strong>PVC Cards (waterproof):</strong> <a href="https://amzn.to/49KHshc" target="_blank" class="text-blue-600 hover:underline">3.38" x 2.13" PVC Cards on Amazon</a></div>
              <div><strong>Card Printer:</strong> <a href="https://amzn.to/4sookwS" target="_blank" class="text-blue-600 hover:underline">Recommended Printer on Amazon</a></div>
              <div class="text-gray-500 text-xs mt-2">Alternative: Use thick cardstock paper with any inkjet printer. PVC cards are waterproof and more durable for rack environments.</div>
            </div>
          </div>
          
          <!-- Options -->
          <div class="mb-6 flex flex-wrap gap-4 items-center">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Select Animals</label>
              <select id="binTagAnimalSelect" onchange="updateBinTagAnimalList(); updateBinTagPreview();" class="px-3 py-2 border border-gray-300 rounded-xl text-sm">
                <option value="all">All Animals</option>
                <option value="breeders">Breeders Only</option>
                <option value="hatchlings">Hatchlings Only</option>
              </select>
            </div>
            <button onclick="downloadBinTagsPDF()" id="binTagDownloadBtn" class="px-4 py-2 bg-gray-900 text-white font-bold rounded-xl hover:bg-black text-sm">
              Print Tags
            </button>
          </div>
          
          <!-- Animal Selection List -->
          <div class="mb-4">
            <div class="flex items-center justify-between mb-2">
              <label class="text-sm font-medium text-gray-700">Select specific animals (or leave unchecked for all)</label>
              <div class="flex gap-2">
                <button onclick="selectAllBinTagAnimals()" class="text-xs text-gray-500 hover:text-gray-700">Select All</button>
                <span class="text-gray-300">|</span>
                <button onclick="deselectAllBinTagAnimals()" class="text-xs text-gray-500 hover:text-gray-700">Deselect All</button>
              </div>
            </div>
            <div id="binTagAnimalList" class="border border-gray-200 rounded-xl p-3 bg-gray-50 max-h-40 overflow-auto">
              <p class="text-gray-500 text-sm">Loading animals...</p>
            </div>
            <div class="mt-2 text-sm text-gray-500">
              <span id="binTagSelectedCount">0</span> animals selected
            </div>
          </div>
          
          <!-- Preview -->
          <div class="text-sm font-medium text-gray-700 mb-2">Preview</div>
          <div id="binTagPreview" class="border border-gray-200 rounded-xl p-4 bg-gray-100 overflow-auto" style="max-height: 500px;">
            <p class="text-gray-500 text-sm">Select animals to see preview...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-4xl my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <h3 class="text-xl font-bold text-slate-900">Import Collection</h3>
          <button onclick="closeImportModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <div class="p-4 md:p-6">
          <!-- Step 1: Upload -->
          <div id="importStep1">
            <div class="mb-4">
              <p class="text-gray-600 mb-4">Upload a CSV file exported from your Collection sheet. The system will auto-generate UNIQUE IDs for each imported row.</p>
              <label class="block">
                <span class="sr-only">Choose CSV file</span>
                <input type="file" id="importFileInput" accept=".csv" onchange="handleImportFile(event)" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:text-sm file:font-semibold file:bg-gray-900 file:text-white hover:file:bg-black cursor-pointer"/>
              </label>
            </div>
          </div>
          
          <!-- Step 2: Preview -->
          <div id="importStep2" class="hidden">
            <div class="mb-4 flex items-center justify-between">
              <div>
                <span id="importCount" class="font-bold text-gray-900">0</span>
                <span class="text-gray-600">animals to import</span>
              </div>
              <div class="flex gap-2">
                <button onclick="resetImport()" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-300 text-sm">
                  Back
                </button>
                <button onclick="executeImport()" id="importBtn" class="px-4 py-2 bg-gray-900 text-white font-bold rounded-xl hover:bg-black text-sm">
                  Import All
                </button>
              </div>
            </div>
            
            <!-- Preview Table -->
            <div class="border border-gray-200 rounded-xl overflow-hidden">
              <div class="max-h-96 overflow-auto">
                <table class="min-w-full text-sm">
                  <thead class="bg-gray-50 sticky top-0">
                    <tr>
                      <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600">Action</th>
                      <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600">Name</th>
                      <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600">Manual ID</th>
                      <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600">Sex</th>
                      <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600">Status</th>
                      <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600">Genes</th>
                    </tr>
                  </thead>
                  <tbody id="importPreviewBody" class="divide-y divide-gray-100">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <!-- Step 3: Progress -->
          <div id="importStep3" class="hidden">
            <div class="text-center py-8">
              <div class="mb-4">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-gray-300 border-t-gray-900"></div>
              </div>
              <p id="importProgress" class="text-gray-600 font-medium">Importing...</p>
              <p class="text-gray-400 text-sm mt-2">Please be patient - this may take a few minutes for large imports.</p>
              <p class="text-gray-400 text-sm">Do not close this window.</p>
            </div>
          </div>
          
          <!-- Step 4: Complete -->
          <div id="importStep4" class="hidden">
            <div class="text-center py-8">
              <div class="text-4xl mb-4">Done!</div>
              <p id="importResult" class="text-gray-600 mb-4">Successfully imported 0 animals.</p>
              <button onclick="closeImportModal(); loadData();" class="px-4 py-2 bg-gray-900 text-white font-bold rounded-xl hover:bg-black text-sm">
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Modal -->
  <div id="modal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-2xl my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <h3 id="modalTitle" class="text-xl font-bold text-slate-900">Add New</h3>
          <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <!-- Read-only ID display -->
        <div id="modalIdDisplay" class="hidden px-4 md:px-6 pt-4">
          <div class="bg-slate-100 rounded-xl px-4 py-3">
            <div class="text-xs text-slate-500 uppercase">Unique ID</div>
            <div id="modalIdValue" class="font-bold mono text-lg"></div>
            <div class="text-xs text-slate-400">Auto-generated (read-only)</div>
          </div>
        </div>

        <div id="modalBody" class="p-4 md:p-6 max-h-[60vh] overflow-auto"></div>

        <div class="p-4 md:p-6 border-t border-slate-200 flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
          <span id="modalError" class="text-red-600 text-sm"></span>
          <div class="flex gap-3">
            <button onclick="closeModal()" class="px-5 py-2.5 bg-slate-100 text-slate-700 font-bold rounded-xl hover:bg-slate-200">
              Cancel
            </button>
            <button id="saveBtn" onclick="saveRecord()" class="px-5 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-black">
              Save
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hatch Modal -->
  <div id="hatchModal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-4xl my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <div>
            <h3 class="text-xl font-bold text-slate-900">Hatch Clutch</h3>
            <p id="hatchClutchId" class="text-sm text-slate-500"></p>
          </div>
          <button onclick="closeHatchModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <div id="hatchModalBody" class="p-4 md:p-6"></div>

        <div class="p-4 md:p-6 border-t border-slate-200 flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
          <span id="hatchModalError" class="text-red-600 text-sm"></span>
          <div class="flex flex-wrap gap-3">
            <button onclick="closeHatchModal()" class="px-5 py-2.5 bg-slate-100 text-slate-700 font-bold rounded-xl hover:bg-slate-200">
              Cancel
            </button>
            <button id="hatchOnlyBtn" onclick="markHatchedOnly()" class="px-5 py-2.5 bg-gray-600 text-white font-bold rounded-xl hover:bg-gray-700">
              Mark Hatched Only
            </button>
            <button id="hatchAndCreateBtn" onclick="hatchAndCreateHatchlings()" class="px-5 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-black">
              Hatch & Create Hatchlings
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sale Modal -->
  <div id="saleModal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-lg my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <div>
            <h3 class="text-xl font-bold text-slate-900">Record Sale</h3>
            <p id="saleAnimalId" class="text-sm text-slate-500 mono"></p>
          </div>
          <button onclick="closeSaleModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <div id="saleModalBody" class="p-4 md:p-6"></div>

        <div class="p-4 md:p-6 border-t border-slate-200 flex justify-between items-center">
          <span id="saleModalError" class="text-red-600 text-sm"></span>
          <div class="flex gap-3">
            <button onclick="closeSaleModal()" class="px-5 py-2.5 bg-slate-100 text-slate-700 font-bold rounded-xl hover:bg-slate-200">
              Cancel
            </button>
            <button id="saveSaleBtn" onclick="saveSale()" class="px-5 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-black">
              Save Sale
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Invoice Modal -->
  <div id="invoiceModal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-4xl my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <div>
            <h3 class="text-xl font-bold text-slate-900">Create Invoice</h3>
            <p id="invoiceNumber" class="text-sm text-slate-500 mono"></p>
          </div>
          <button onclick="closeInvoiceModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <div id="invoiceModalBody" class="p-4 md:p-6 max-h-[70vh] overflow-auto"></div>

        <div class="p-4 md:p-6 border-t border-slate-200 flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
          <span id="invoiceModalError" class="text-red-600 text-sm"></span>
          <div class="flex flex-wrap gap-3">
            <button onclick="closeInvoiceModal()" class="px-5 py-2.5 bg-slate-100 text-slate-700 font-bold rounded-xl hover:bg-slate-200">
              Cancel
            </button>
            <button onclick="previewInvoice()" class="px-5 py-2.5 bg-gray-600 text-white font-bold rounded-xl hover:bg-gray-700">
              Preview
            </button>
            <button onclick="downloadInvoicePDF()" class="px-5 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-black">
              Download PDF
            </button>
            <button onclick="printInvoice()" class="px-5 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-black">
              Print
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Invoice Preview Modal -->
  <div id="invoicePreviewModal" class="fixed inset-0 bg-black/50 modal-backdrop hidden z-50 overflow-auto">
    <div class="min-h-screen flex items-start justify-center p-4">
      <div class="w-full max-w-4xl my-8 bg-white rounded-2xl shadow-2xl">
        <div class="p-4 md:p-6 border-b border-slate-200 flex items-center justify-between">
          <h3 class="text-xl font-bold text-slate-900">Invoice Preview</h3>
          <button onclick="closeInvoicePreview()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        
        <div id="invoicePreviewBody" class="p-4 md:p-6 max-h-[70vh] overflow-auto bg-gray-100">
          <div id="invoicePrintArea"></div>
        </div>

        <div class="p-4 md:p-6 border-t border-slate-200 flex justify-end gap-3">
          <button onclick="closeInvoicePreview()" class="px-5 py-2.5 bg-slate-100 text-slate-700 font-bold rounded-xl hover:bg-slate-200">
            Back to Edit
          </button>
          <button onclick="downloadInvoicePDF()" class="px-5 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-black">
            Download PDF
          </button>
          <button onclick="printInvoiceFromPreview()" class="px-5 py-2.5 bg-gray-900 text-white font-bold rounded-xl hover:bg-black">
            Print
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="mt-8 py-6 border-t border-gray-200 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 text-center text-sm text-gray-500">
      <div class="mb-2">
        <a href="https://therackapp.io/policies/privacy-policy" target="_blank" class="hover:text-gray-700 hover:underline">Privacy Policy</a>
        <span class="mx-2">|</span>
        <a href="https://therackapp.io/policies/terms-of-service" target="_blank" class="hover:text-gray-700 hover:underline">Terms of Service</a>
      </div>
      <div>
        (c) 2026 The Rack App | DBA Soul Serpents, LLC. All rights reserved.
      </div>
    </div>
  </footer>

  <!-- JavaScript Files (order matters!) -->
  <script src="config.js"></script>
  <script src="api.js"></script>
  <script src="app.js"></script>
  <script src="dashboard.js"></script>
  <script src="tables.js"></script>
  <script src="modals.js"></script>
  <script src="hatch-sale.js"></script>
  <script src="tools.js"></script>
  <script src="archive.js"></script>
  <script src="bintags.js"></script>
  <script src="import.js"></script>
  <script src="invoice.js"></script>
  <script src="qr-activity.js"></script>
  
  <!-- Initialize -->
  <script>
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
